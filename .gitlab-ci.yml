image: microsoft/dotnet:2.1-sdk-alpine

stages:
  - build
  - test
  - deploy

build ChickenAPI:
  stage: build
  tags:
    - docker
    - dotnet
  variables:
    build_path: "src/ChickenAPI"
  script:
    - "cd $build_path"
    - "dotnet build"

build samples:
  stage: build
  tags:
    - docker
    - dotnet
  script:
    - "cd samples/ChickenAPI.HelloWorldPlugin"
    - "dotnet build"
    
test ChickenAPI:
  stage: test
  tags:
    - docker
    - dotnet
  variables:
    build_path: "test/ChickenAPI.Test"
  script:
    - "cd $build_path"
    - "dotnet test"

test Packet List Markdown:
  stage: test
  tags:
    - docker
    - dotnet
  variables:
    file: /tmp/supposed_file
  script:
   - chmod +x scripts/packet_list.sh > $file # generate the packet list markdown file
   - cat $file
   - diff $file src/ChickenAPI/Packets/README.md # compare the repository one and the previously generated one
   - mv $file supposed_packet_md.md
  artifacts:
    paths:
    - supposed_packet_md.md
    expire_in: 1 week

